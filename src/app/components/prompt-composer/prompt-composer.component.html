<!-- Simplified prompt composer template -->
<div class="flex flex-col h-full relative">
	<div
		id="composer-content"
		class="flex-1 space-y-6 overflow-y-auto px-6 py-4 pb-24"
	>
		<!-- Prompt Template Section -->
		<section>
			<div class="flex justify-between items-center mb-3">
				<h3 class="text-lg font-semibold flex items-center gap-2">
					<img src="assets/icons/settings.svg" alt="settings" class="w-5 h-5" />
					Prompt Template
				</h3>
				<button
					(click)="openPresetsModal()"
					class="bg-darkprimary/50 px-4 py-2 rounded-xl hover:bg-neutral-700/50 active:bg-neutral-600/50 transition-all duration-150 flex items-center gap-2 text-sm border border-neutral-700/50"
				>
					<img src="assets/icons/bookmark.svg" alt="presets" class="w-4 h-4" />
					Presets
				</button>
			</div>
			<textarea
				[(ngModel)]="localPromptTemplate"
				(ngModelChange)="onPromptTemplateChange()"
				rows="14"
				placeholder="Enter full content template here..."
				[disabled]="isEnhancing || isConverting"
				class="w-full bg-darkprimary/50 resize-none rounded-xl p-4 outline-none focus:outline-none border-2 border-transparent focus:border-indigo-500 placeholder-neutral-500 transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
			></textarea>
			<div
				class="flex justify-between items-center text-sm mt-2 text-neutral-400"
			>
				<div class="flex items-center gap-2">
					Placeholders:
					<code
						class="bg-darkprimary/50 px-2 py-1 rounded-lg border border-neutral-700/50 inline-flex"
						>{{ '{{files}}' }}</code
					>
				</div>
				<div class="flex gap-4 items-center relative">
					<button
						(click)="onEnhancePrompt()"
						[disabled]="isEnhancing"
						class="bg-indigo-500 text-white px-6 py-2.5 rounded-xl hover:bg-indigo-600 active:bg-indigo-700 transition-all duration-150 flex items-center gap-2 font-medium disabled:opacity-70 disabled:cursor-wait"
					>
						<div *ngIf="isEnhancing" class="animate-spin w-5 h-5">
							<svg
								class="w-5 h-5"
								xmlns="http://www.w3.org/2000/svg"
								fill="none"
								viewBox="0 0 24 24"
							>
								<circle
									class="opacity-25"
									cx="12"
									cy="12"
									r="10"
									stroke="currentColor"
									stroke-width="4"
								></circle>
								<path
									class="opacity-75"
									fill="currentColor"
									d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
								></path>
							</svg>
						</div>
						<img
							*ngIf="!isEnhancing"
							src="assets/icons/sparkles.svg"
							alt="enhance icon"
							class="w-5 h-5"
						/>
						<span>{{ isEnhancing ? "Enhancing..." : "Enhance" }}</span>
					</button>
					<div class="relative">
						<button
							(click)="toggleConvertDropdown()"
							[disabled]="isConverting"
							class="bg-indigo-500 text-white px-6 py-2.5 rounded-xl hover:bg-indigo-600 active:bg-indigo-700 transition-all duration-150 flex items-center gap-2 font-medium disabled:opacity-70 disabled:cursor-wait"
						>
							<div *ngIf="isConverting" class="animate-spin w-5 h-5">
								<svg
									class="w-5 h-5"
									xmlns="http://www.w3.org/2000/svg"
									fill="none"
									viewBox="0 0 24 24"
								>
									<circle
										class="opacity-25"
										cx="12"
										cy="12"
										r="10"
										stroke="currentColor"
										stroke-width="4"
									></circle>
									<path
										class="opacity-75"
										fill="currentColor"
										d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
									></path>
								</svg>
							</div>
							<img
								*ngIf="!isConverting"
								src="assets/icons/transform.svg"
								alt="convert icon"
								class="w-5 h-5"
							/>
							<span>{{ isConverting ? "Converting..." : "Convert" }}</span>
						</button>
						<div
							*ngIf="showConvertDropdown"
							class="absolute right-0 mt-2 bg-darkprimary border border-neutral-700/50 rounded-md shadow-lg z-10"
						>
							<button
								(click)="onConvert('XML')"
								class="block w-full text-left px-4 py-2 hover:bg-neutral-700/30"
							>
								XML
							</button>
							<button
								(click)="onConvert('Markdown')"
								class="block w-full text-left px-4 py-2 hover:bg-neutral-700/30"
							>
								Markdown
							</button>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- File Template Section -->
		<section>
			<h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
				<img src="assets/icons/file.svg" alt="file" class="w-5 h-5" />
				File Template
			</h3>
			<textarea
				[(ngModel)]="localFileTemplate"
				(ngModelChange)="onFileTemplateChange()"
				rows="8"
				placeholder="Enter file copy template here..."
				class="w-full bg-darkprimary/50 resize-none rounded-xl p-4 outline-none focus:outline-none border-2 border-transparent focus:border-indigo-500 placeholder-neutral-500 transition-all duration-300 ease-in-out"
			></textarea>
			<p
				class="text-sm mt-2 text-neutral-400 flex items-center gap-2 flex-wrap"
			>
				Placeholders:
				<code
					class="bg-darkprimary/50 px-2 py-1 rounded-lg border border-neutral-700/50 inline-flex"
					>{{ '{{file_name}}' }}</code
				>
				<code
					class="bg-darkprimary/50 px-2 py-1 rounded-lg border border-neutral-700/50 inline-flex"
					>{{ '{{file_content}}' }}</code
				>
				<code
					class="bg-darkprimary/50 px-2 py-1 rounded-lg border border-neutral-700/50 inline-flex"
					>{{ '{{file_path}}' }}</code
				>
			</p>
		</section>
	</div>

	<div
		id="composer-footer"
		class="absolute bottom-0 left-0 right-0 bg-darkbg border-t border-neutral-700/50"
	>
		<div class="px-6 py-4 flex justify-between items-center">
			<div class="flex items-center gap-4">
				<button
					(click)="onCopyPrompt()"
					[disabled]="isCopying"
					class="bg-indigo-500 text-white px-6 py-2.5 rounded-xl hover:bg-indigo-600 active:bg-indigo-700 transition-all duration-150 flex items-center gap-2 font-medium disabled:opacity-70 disabled:cursor-wait"
				>
					<ng-container *ngIf="isCopying; else copyIcon">
						<div class="animate-spin w-5 h-5">
							<svg
								class="w-5 h-5"
								xmlns="http://www.w3.org/2000/svg"
								fill="none"
								viewBox="0 0 24 24"
							>
								<circle
									class="opacity-25"
									cx="12"
									cy="12"
									r="10"
									stroke="currentColor"
									stroke-width="4"
								></circle>
								<path
									class="opacity-75"
									fill="currentColor"
									d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
								></path>
							</svg>
						</div>
					</ng-container>
					<ng-template #copyIcon>
						<img src="assets/icons/copy.svg" alt="copy icon" class="w-5 h-5" />
					</ng-template>
					<span>{{ isCopying ? "Copying..." : "Copy Prompt" }}</span>
				</button>
				<div *ngIf="aggregatedMetrics" class="text-sm text-neutral-400">
					{{ aggregatedMetrics.size | fileSize }} |
					{{ aggregatedMetrics.lineCount }} lines |
					{{ aggregatedMetrics.tokenCount | abbreviateNumber }} tokens
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Presets Modal -->
<div
	*ngIf="showPresetsModal"
	class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4"
	(click)="closePresetsModal()"
>
	<div
		class="bg-darkbg border border-neutral-700/50 rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden"
		(click)="$event.stopPropagation()"
	>
		<div
			class="px-6 py-4 border-b border-neutral-700/50 flex justify-between items-center"
		>
			<h2 class="text-xl font-semibold flex items-center gap-2">
				<img src="assets/icons/bookmark.svg" alt="presets" class="w-5 h-5" />
				Prompt Presets
			</h2>
			<button
				(click)="closePresetsModal()"
				class="text-neutral-400 hover:text-white transition-colors duration-150 p-1 hover:bg-neutral-700/30 rounded-lg"
			>
				<svg
					class="w-5 h-5"
					fill="none"
					stroke="currentColor"
					viewBox="0 0 24 24"
				>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
						d="M6 18L18 6M6 6l12 12"
					></path>
				</svg>
			</button>
		</div>
		<div class="p-6 space-y-4">
			<button
				*ngIf="!showSavePresetDialog"
				(click)="showSavePresetDialog = true"
				class="w-full bg-darkprimary/50 border border-neutral-700/50 px-4 py-3 rounded-xl hover:bg-neutral-700/50 active:bg-neutral-600/50 transition-all duration-150 flex items-center justify-center gap-2"
			>
				<img src="assets/icons/plus.svg" alt="save" class="w-5 h-5" />
				<span class="text-sm font-medium"
					>Save Current Configuration as Preset</span
				>
			</button>
			<div
				*ngIf="showSavePresetDialog"
				class="bg-darkprimary/30 border border-neutral-700/50 p-4 rounded-xl space-y-4"
			>
				<input
					[(ngModel)]="newPresetName"
					placeholder="Enter preset name..."
					class="w-full bg-darkprimary/50 border border-neutral-700/50 rounded-xl px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-neutral-500 text-sm"
				/>
				<div class="flex gap-2 justify-end">
					<button
						(click)="showSavePresetDialog = false"
						class="px-4 py-2 rounded-xl hover:bg-neutral-700/50 active:bg-neutral-600/50 transition-all duration-150 text-sm font-medium border border-neutral-700/50"
					>
						Cancel
					</button>
					<button
						(click)="savePreset()"
						class="bg-indigo-500 text-white px-4 py-2 rounded-xl hover:bg-indigo-600 active:bg-indigo-700 transition-all duration-150 text-sm font-medium"
					>
						Save Preset
					</button>
				</div>
			</div>
			<div class="space-y-2 max-h-[400px] overflow-y-auto">
				<div
					*ngFor="let preset of presets"
					class="bg-darkprimary/30 border border-neutral-700/50 p-4 rounded-xl hover:bg-neutral-700/30 transition-all duration-150 flex justify-between items-center group cursor-pointer"
					(click)="loadPreset(preset)"
				>
					<span class="font-medium">{{ preset.name }}</span>
					<button
						(click)="deletePreset($event, preset.id)"
						class="text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-150 hover:text-red-600 p-1 hover:bg-red-500/10 rounded-lg"
					>
						<img src="assets/icons/trash.svg" alt="delete" class="w-4 h-4" />
					</button>
				</div>
				<div
					*ngIf="presets.length === 0"
					class="text-neutral-400 text-center py-8"
				>
					No presets saved yet
				</div>
			</div>
		</div>
	</div>
</div>
